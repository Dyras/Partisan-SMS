name: Build Release

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Add passwords
        run: printf "RELEASE_KEY_PASSWORD=$RELEASE_KEY_PASSWORD\nRELEASE_STORE_PASSWORD=$RELEASE_STORE_PASSWORD\nRELEASE_KEY_ALIAS=$RELEASE_KEY_ALIAS\n" > gradle.properties
        env:
          RELEASE_KEY_PASSWORD: android
          RELEASE_STORE_PASSWORD: android
          RELEASE_KEY_ALIAS: key0
      - name: Add keystore
        run: base64 -d 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 > presentation/config/release.keystore
      - name: Build docker image
        run: docker build -f Dockerfile -t p-sms-build .
      - name: Build app
        run: docker run --rm -v "$PWD":/home/source p-sms-build
      - name: Print Hash
        working-directory: ${{env.GITHUB_WORKSPACE}}
        run: sha256sum presentation/noAnalytics/release/QKSMS-v3.9.4-noAnalytics-release.apk
      - name: Save artifact
        uses: actions/upload-artifact@master
        with:
          name: P-SMS.apk
          path: TMessagesProj/build/outputs/apk/afat/alpha/QKSMS-v3.9.4-noAnalytics-release.apk
